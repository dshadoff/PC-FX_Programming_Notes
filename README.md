# PC-FX_Programming_Notes

Shorthand and reference materials specifically for programming the PC-FX machine.


## About this Repository

There is a lot of information scattered around the internet about PC-FX programming, but
many points are easily forgotten or need to be collected from disparate locations.  This
repository is intended to gather a lot of that into a central location, so that new
programmers and multi-system programmers can have quick access to various quick-lookup
questions they may have.  The repository is intended to start small and grow over time.


## Developmnet Tools

While the PC-FXGA board and tools were originally created in 1996 to promote development,
very few of these are in the hands of developers, and the tools generally require a 1996-era
computer to run on.  This is not the focus of this repository, but there may eventually be a
separate section devoted to the use of PC-FXGA for development.

The modern tools which will be referenced in this repository are:
These can be found here:\
[https://github.com/jbrandwood/v810-gcc](https://github.com/jbrandwood/v810-gcc)\
[https://github.com/jbrandwood/pcfxtools](https://github.com/jbrandwood/pcfxtools)\
[https://github.com/jbrandwood/liberis](https://github.com/jbrandwood/liberis)\
[https://github.com/pcfx-devel/PC-FX_Programming_Tools](https://github.com/pcfx-devel/PC-FX_Programming_Tools)

Some of the above tools are not currently held by the pcfx-devel organization, but
may soon be available here - either due to transfer, or by fork.


### Hardware Register Usage and Conventions

For an overview of how HARDWARE uses the V810's 32 registers, first look at the 
[V810 Manual](Manuals/V810_Users_Manual.pdf), Chapter 2, "Register Set" (starting on page 6).

This outlines that:

 - r0 = Zero Register (always zero)
 - r1-r5 = used by hardware
 - r6-r25 = available (But subject to software conventions)
 - r26-r30 = used by special opcodes
 - r31 = Link Pointer (return address for subroutines)

#### gcc 'C' Compiler Parameter Conventions:

The following refers to code generated by the gcc 'C' compiler, and may have differences from
the Hudson compiler in the PC-FXGA kit.

When 'C' passses paramters from function to function, the first 4 parameters are passed by
register, with any remaining paramters being pushed onto the stack; together with the fact
that the Link Pointer (return address) is passed by register, this creates the environment
for small subroutines to completely avoid stack usage.

In the following scenario:

x = function(a, b, c, d, e);

 - r6 receives the value of 'a'
 - r7 recieves the value of 'b'
 - r8 recieves the value of 'c'
 - r9 recieves the value of 'd'
 - the value of 'e' is pushed onto the stack
 - the value in r10 is used as a return value, and is assigned back to 'x'

#### gcc 'C' Compiler Register Allocation

Notwithstanding the above for parameter-passing, some registers are BY CONVENTION 'scratch'
variables and each function is free to destry them, without pushing them on the stack - so
it is the calling function's responsibility to push them on the stack if needed.
 - r6-r19 are "caller saved"

Some regiaters are BY CONVENTION preserved, meaning that called functions are obligated to
push them on the stack if they are used within the function.
 - r20-r29 are "callee saved"


### Including/Enbedding/Linking a binary file into your project

[Linking with a binary object file](https://pcengine.proboards.com/post/16767)


### Memory Map

(coming soon)


## External Links

[Daifukkat.su](http://daifukkat.su/pcfx/) - This is a translation of technical data from Buppu's PC-FXGA pages (a Japanese site)
[Buppu's PC-FXGA page](https://hp.vector.co.jp/authors/VA007898/pcfxga/) - Originals of the above
[Matej Horvat's site](https://matejhorvat.si/en/pcfx/index.htm) - Various information including a homebrew game

[Thread discussing SCSI commands](https://pcengine.proboards.com/thread/1228/pce-pc-scsi-rom-commands)


### Japanese PC-FX and PC-FXGA pages:

[fenix.ne.jp/~fez](http://www.fenix.ne.jp/~fez/soft/fxga/)
[FX-ron](https://www2s.biglobe.ne.jp/tetuya/FXHP/fxron.html)
[MIX2AVI](https://web.archive.org/web/20210128020037/http://hwbb.gyao.ne.jp/soltin/mix2avi.html)

